<% content_for :main_container_class, 'min-h-screen bg-neutral' %>
<% content_for :hide_footer, true %>
<% content_for :hide_navigation, true %>

<div class="max-w-2xl mx-auto h-screen flex flex-col relative">
  
  <!-- Header -->
  <div class="flex-shrink-0 px-2 md:p-4 border-b border-primary">
    <div class="flex justify-between items-center">
      <% 
        # Check if user came from a user profile page
        came_from_profile = request.referer&.include?('/users/') && !request.referer&.include?('/messages')
        back_text = came_from_profile ? "← Back" : "← Back to Messages"
        back_path = came_from_profile ? :back : private_messages_path
      %>
      <%= link_to back_text, back_path, 
          class: "text-primary hover:text-primary-focus hover:bg-primary/10 text-sm font-medium px-2 py-1 rounded transition-colors" %>
      <h1 class="md:text-2xl text-lg font-bold text-primary">
        <% if @room.room_type == 'private' && @other_user %>
          Private chat with <%= @other_user.name %>
        <% else %>
          <%= @room.name %>
        <% end %>
      </h1>
    </div>
  </div>
  
  <!-- Vertical Lines (covering entire height) -->
  <div class="absolute left-0 top-0 bottom-0 w-px bg-primary z-10"></div>
  <div class="absolute right-0 top-0 bottom-0 w-px bg-primary z-10"></div>
  
  <!-- Messages Container -->
  <div class="flex-1 relative overflow-hidden">
    <div id="messages" 
         class="h-full overflow-y-auto p-4"
         data-controller="scroll-to room-channel message-positioning"
         data-room-channel-room-id-value="<%= @room.id %>"
         data-room-channel-current-user-id-value="<%= Current.user.id %>"
         data-message-positioning-current-user-id-value="<%= Current.user.id %>"
         data-action="turbo:stream-render->scroll-to#scrollToBottom">
      <%= render partial: "messages/message", collection: @messages, cached: true %>
    </div>
  </div>
  
  <!-- Message Form at Bottom -->
  <div class="flex-shrink-0 bg-neutral-content">
    <div id="message_form">
      <%= render "messages/form", message: @message, room: @room %>
    </div>
  </div>
</div>
