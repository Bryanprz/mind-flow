<% content_for :main_container_class, 'bg-base-200' %>

<%# Define the active plan once at the top for clarity and efficiency %>
<% active_plan = @user.healing_plans.find_by(is_active: true) %>

<div class="container mx-auto px-4 py-8">
  <div class="card w-full max-w-lg mx-auto bg-base-100 border border-gray-300">
    <div class="card-body">
      <h2 class="card-title text-2xl mb-4"><%= @user.name %></h2>

      <div class="space-y-2">
        <p><strong>Email:</strong> <%= @user.email_address %></p>
        <p><strong>Admin:</strong> <%= @user.admin? ? 'Yes' : 'No' %></p>
        <p><strong>Member since:</strong> <%= @user.created_at.to_formatted_s(:long) %></p>
        <% if active_plan %>
          <p><strong>Active Healing Plan:</strong> <%= active_plan.name %></p>
        <% end %>
      </div>

      <div class="card-actions justify-end mt-6 flex-wrap">
        <%= link_to "Prakruti", edit_admin_user_path(@user), class: "btn btn-sm btn-primary text-white" %>
        <%= link_to "Vikruti", edit_admin_user_path(@user), class: "btn btn-sm btn-accent" %>
        <%= link_to "Edit", edit_admin_user_path(@user), class: "btn btn-sm btn-secondary" %>
        <%= link_to "Back", admin_users_path, class: "btn btn-sm btn-ghost" %>
        <% if active_plan %>
          <%= link_to "Health Plan", admin_user_healing_plan_path(@user, active_plan), class: "btn btn-sm btn-accent" %>
        <% else %>
          <%= link_to "Health Plan", new_admin_user_healing_plan_path(@user), class: "btn btn-sm btn-accent" %>
        <% end %>
        <%= button_to "Delete", [:admin, @user], method: :delete, data: { turbo_confirm: "Are you sure you want to delete this user?" }, class: "btn btn-sm btn-error" %>
      </div>
    </div>
  </div>
</div>
