<% content_for :main_container_class, 'w-full flex-1 bg-base-200 p-8' %>
<% content_for :title, @show_week_view ? "This Week's Progress" : "All Check-Ins" %>

<div class="w-full flex flex-col items-center">
  <div class="max-w-4xl mx-auto w-full space-y-6 flex-grow">
    <div class="flex flex-col items-center justify-between">
      <h1 class="font-bold text-2xl md:text-4xl">
        <%= @show_week_view ? "This Week's Progress" : "All Check-Ins" %>
      </h1>
      <p class="text-gray-600 mt-2">
        <%= @show_week_view ? "Track your daily healing journey" : "Complete history of your healing journey" %>
      </p>
    </div>

    <!-- Week Overview Cards (only show in week view) -->
    <% if @show_week_view %>
    <div class="hidden md:grid grid-cols-7 gap-4 mb-6">
      <% @week_days.each do |day| %>
        <div class="card bg-base-100 border-2 <%= 'border-primary' if day[:is_today] %> <%= 'opacity-50' if day[:is_future] %>">
          <div class="card-body p-3 text-center">
            <div class="text-sm font-medium text-gray-600">
              <%= day[:date].strftime("%a") %>
            </div>
            <div class="text-lg font-bold">
              <%= day[:date].strftime("%d") %>
            </div>
            
            <!-- Status Indicator -->
            <div class="mt-2 flex justify-center">
              <% if day[:is_future] %>
                <div class="badge badge-ghost text-xs">Future</div>
              <% elsif day[:is_completed] %>
                <div class="badge badge-success text-xs">‚úÖ Done</div>
              <% elsif day[:log] %>
                <div class="badge badge-warning text-xs">üìù Started</div>
              <% else %>
                <div class="badge badge-error text-xs whitespace-nowrap">Not Started</div>
              <% end %>
            </div>
            
          </div>
        </div>
      <% end %>
    </div>
    <% end %>

    <!-- Detailed Logs Table (Desktop) -->
    <div class="hidden md:block">
      <h2 class="text-xl font-semibold mb-4">
        <%= @show_week_view ? "" : "" %>
      </h2>
      <% logs_to_show = @show_week_view ? @existing_logs.values : @all_logs %>
      <% if logs_to_show.any? %>
        <table class="table bg-base-100">
          <thead>
            <tr class="text-center">
              <th>Date</th>
              <th>Status</th>
              <th>Journal Preview</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% logs_to_show.sort_by(&:date).reverse.each do |log| %>
              <tr class="text-center">
                <td><%= log.date.strftime("%b %d, %Y") %></td>
                <td>
                  <% if log.completed_at.present? %>
                    <span class="badge badge-success">‚úÖ Completed</span>
                  <% else %>
                    <span class="badge badge-warning">üìù In Progress</span>
                  <% end %>
                </td>
                <td>
                  <% if log.journal_entry.present? %>
                    <%= truncate(log.journal_entry, length: 30) %>
                  <% else %>
                    <span class="text-gray-400">No journal entry</span>
                  <% end %>
                </td>
                <td>
                  <%= link_to "View", my_healing_plan_path(date: log.date), 
                      class: "btn btn-sm btn-secondary" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <div class="text-center py-8 text-gray-500">
          <p><%= @show_week_view ? "No activity yet this week. Start your healing journey today!" : "No logs found. Start your healing journey today!" %></p>
        </div>
      <% end %>
    </div>

    <!-- Mobile Cards -->
    <div class="block md:hidden">
      <h2 class="text-xl font-semibold mb-4">
        <%= @show_week_view ? "" : "" %>
      </h2>
      <% logs_to_show = @show_week_view ? @existing_logs.values : @all_logs %>
      <% if logs_to_show.any? %>
        <% logs_to_show.sort_by(&:date).reverse.each do |log| %>
          <%= render 'log_card', healing_plan_log: log %>
        <% end %>
      <% else %>
        <div class="text-center py-8 text-gray-500">
          <p><%= @show_week_view ? "No activity yet this week. Start your healing journey today!" : "No logs found. Start your healing journey today!" %></p>
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Quick Actions -->
  <div class="flex flex-col sm:flex-row gap-4 mt-6">
    <%= link_to "Today's Check-in", my_healing_plan_path, 
        class: "btn btn-primary text-white" %>
    <% if @show_week_view %>
      <%= link_to "View All Logs", healing_plan_logs_path(view: 'all'), 
          class: "btn btn-outline" %>
    <% else %>
      <%= link_to "This Week's View", healing_plan_logs_path, 
          class: "btn btn-outline" %>
    <% end %>
  </div>
</div>
