<%= form_with model: [social_post, SocialPost.new], 
    url: social_post_replies_path(social_post),
    class: "space-y-3", 
    data: { 
      controller: "image-preview",
      image_preview_form_id_value: "reply_#{social_post.id}"
    },
    multipart: true do |f| %>
  <%= f.hidden_field :parent_post_id, value: social_post.id, id: "social_post_parent_post_id_#{social_post.id}" %>
  
  <div class="border border-gray-300 rounded-lg overflow-hidden">
    <%= f.rich_text_area :content, 
        placeholder: "Reply to @#{social_post.user.handle.presence || social_post.user.name.downcase.gsub(' ', '_')}...", 
        class: "w-full min-h-[100px] p-3 border-0 resize-none focus:ring-0 focus:outline-none" %>
  </div>
  
  <!-- Show validation errors if any -->
  <% if social_post.errors.any? %>
    <div class="text-red-500 text-sm">
      <% social_post.errors.full_messages.each do |message| %>
        <p><%= message %></p>
      <% end %>
    </div>
  <% end %>
  
  <!-- Media Upload Section -->
  <div class="form-control">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <%= f.label :media, class: "cursor-pointer text-gray-500 hover:text-primary transition-colors flex items-center gap-2" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
          </svg>
          <span class="text-sm">Add Media</span>
          <%= f.file_field :media, multiple: true, class: "hidden", data: { image_preview_target: "fileInput" } %>
        <% end %>
        
        <div class="text-xs text-gray-400">
          Drag and drop images here or click to upload
        </div>
      </div>
      
      <!-- Submit Button -->
      <%= f.submit "Reply", class: "btn btn-sm btn-primary text-white" %>
    </div>
    
    <!-- Image Preview Area -->
    <div class="mt-3 hidden" data-image-preview-target="previewContainer">
      <div class="grid grid-cols-2 gap-2" data-image-preview-target="previewGrid">
        <!-- Preview images will be inserted here -->
      </div>
    </div>
  </div>
<% end %>
